name: Update learning time

on:
  schedule:
    - cron: "0 12 * * *" # runs daily at 12:00 UTC
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Update README learning time
        env:
          START_DATE: "2026-01-21" # YYYY-MM-DD (your real start date)
          README_FILE: "README.md"
        run: |
          python - << 'PY'
          from datetime import datetime, timezone
          import os, re

          start_date = os.environ["START_DATE"]
          readme_file = os.environ["README_FILE"]

          start = datetime.strptime(start_date, "%Y-%m-%d").replace(tzinfo=timezone.utc)
          now = datetime.now(timezone.utc)

          days = (now - start).days
          if days < 0:
            days = 0

          # English output: "7 days" or "1 month (33 days)" / "2 months (61 days)"
          months = days // 30
          if months >= 1:
            month_label = "month" if months == 1 else "months"
            day_label = "day" if days == 1 else "days"
            text = f"{months} {month_label} ({days} {day_label})"
          else:
            day_label = "day" if days == 1 else "days"
            text = f"{days} {day_label}"

          with open(readme_file, "r", encoding="utf-8") as f:
            content = f.read()

          new_content = re.sub(
            r"<!--\s*LEARNING_TIME\s*-->.*?<!--\s*/LEARNING_TIME\s*-->",
            f"<!-- LEARNING_TIME -->{text}<!-- /LEARNING_TIME -->",
            content,
            flags=re.DOTALL
          )

          if new_content != content:
            with open(readme_file, "w", encoding="utf-8") as f:
              f.write(new_content)

          print("Updated to:", text)
          PY

      - name: Commit changes
        run: |
          if git diff --quiet; then
            echo "No changes to commit."
            exit 0
          fi
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add README.md
          git commit -m "chore: update learning time"
          git push
